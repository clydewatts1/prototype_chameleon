# Retail Sample Data MCP Tools
# Tools to query the retail.db database generated by generate_retail_data.ipynb
# 
# IMPORTANT: All dates are stored as ISO 8601 text strings (YYYY-MM-DD) in SQLite
# Use string comparisons for date filtering

tools:
  # Get sales by store
  - name: get_sales_by_store
    persona: default
    description: Retrieve sales summary for a specific store location, optionally filtered by date
    code_type: select
    code: |
      SELECT 
          sh.sale_id,
          sh.loc_id,
          l.loc_name,
          sh.sales_date,
          sh.tender_total,
          COUNT(sl.item_id) as num_items,
          SUM(sl.sales_units) as total_units
      FROM sales_header sh
      JOIN location l ON sh.loc_id = l.loc_id
      LEFT JOIN sales_line sl ON sh.sale_id = sl.sale_id
      WHERE sh.loc_id = :loc_id
        AND (:sales_date IS NULL OR sh.sales_date = :sales_date)
      GROUP BY sh.sale_id, sh.loc_id, l.loc_name, sh.sales_date, sh.tender_total
      ORDER BY sh.sales_date DESC, sh.sale_id
    input_schema:
      type: object
      properties:
        loc_id:
          type: integer
          description: The location ID of the store
        sales_date:
          type: string
          description: Optional sales date filter in ISO 8601 format (YYYY-MM-DD)
          pattern: '^\d{4}-\d{2}-\d{2}$'
      required:
        - loc_id

  # Get sales by item
  - name: get_sales_by_item
    persona: default
    description: Retrieve sales summary for a specific item, showing total sales and units sold
    code_type: select
    code: |
      SELECT 
          i.item_id,
          i.item_name,
          i.department,
          i.section,
          COUNT(DISTINCT sl.sale_id) as num_transactions,
          SUM(sl.sales_units) as total_units_sold,
          SUM(sl.sales_amount) as total_revenue,
          MIN(sh.sales_date) as first_sale_date,
          MAX(sh.sales_date) as last_sale_date
      FROM item i
      LEFT JOIN sales_line sl ON i.item_id = sl.item_id
      LEFT JOIN sales_header sh ON sl.sale_id = sh.sale_id
      WHERE i.item_id = :item_id
        AND (:start_date IS NULL OR sh.sales_date >= :start_date)
        AND (:end_date IS NULL OR sh.sales_date <= :end_date)
      GROUP BY i.item_id, i.item_name, i.department, i.section
    input_schema:
      type: object
      properties:
        item_id:
          type: integer
          description: The item ID to query
        start_date:
          type: string
          description: Optional start date for filtering in ISO 8601 format (YYYY-MM-DD)
          pattern: '^\d{4}-\d{2}-\d{2}$'
        end_date:
          type: string
          description: Optional end date for filtering in ISO 8601 format (YYYY-MM-DD)
          pattern: '^\d{4}-\d{2}-\d{2}$'
      required:
        - item_id

  # Get stock status
  - name: get_stock_status
    persona: default
    description: Retrieve current or historical stock status for a specific item at a location
    code_type: select
    code: |
      SELECT 
          ds.stock_date,
          ds.loc_id,
          l.loc_name,
          l.loc_type,
          ds.item_id,
          i.item_name,
          ds.stock_on_hand_units,
          ds.stock_on_order_units,
          (ds.stock_on_hand_units + ds.stock_on_order_units) as total_available
      FROM daily_stock ds
      JOIN location l ON ds.loc_id = l.loc_id
      JOIN item i ON ds.item_id = i.item_id
      WHERE ds.item_id = :item_id
        AND (:loc_id IS NULL OR ds.loc_id = :loc_id)
        AND (:stock_date IS NULL OR ds.stock_date = :stock_date)
      ORDER BY ds.stock_date DESC, ds.loc_id
    input_schema:
      type: object
      properties:
        item_id:
          type: integer
          description: The item ID to check stock for
        loc_id:
          type: integer
          description: Optional location ID to filter by specific location
        stock_date:
          type: string
          description: Optional stock date in ISO 8601 format (YYYY-MM-DD). If not provided, returns all dates
          pattern: '^\d{4}-\d{2}-\d{2}$'
      required:
        - item_id

  # Get daily sales summary
  - name: get_daily_sales_summary
    persona: default
    description: Retrieve daily sales summary across all stores or for a specific date
    code_type: select
    code: |
      SELECT 
          sh.sales_date,
          COUNT(DISTINCT sh.sale_id) as total_transactions,
          COUNT(DISTINCT sh.loc_id) as num_stores,
          SUM(sh.tender_total) as total_revenue,
          AVG(sh.tender_total) as avg_transaction_value,
          SUM(sl.sales_units) as total_units_sold,
          COUNT(DISTINCT sl.item_id) as distinct_items_sold
      FROM sales_header sh
      LEFT JOIN sales_line sl ON sh.sale_id = sl.sale_id
      WHERE (:sales_date IS NULL OR sh.sales_date = :sales_date)
        AND (:start_date IS NULL OR sh.sales_date >= :start_date)
        AND (:end_date IS NULL OR sh.sales_date <= :end_date)
      GROUP BY sh.sales_date
      ORDER BY sh.sales_date DESC
    input_schema:
      type: object
      properties:
        sales_date:
          type: string
          description: Optional specific sales date in ISO 8601 format (YYYY-MM-DD)
          pattern: '^\d{4}-\d{2}-\d{2}$'
        start_date:
          type: string
          description: Optional start date for range query in ISO 8601 format (YYYY-MM-DD)
          pattern: '^\d{4}-\d{2}-\d{2}$'
        end_date:
          type: string
          description: Optional end date for range query in ISO 8601 format (YYYY-MM-DD)
          pattern: '^\d{4}-\d{2}-\d{2}$'
      required: []
